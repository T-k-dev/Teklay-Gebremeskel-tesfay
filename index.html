<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        #countdown {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <iframe id="url-frame" src="https://www.effectiveratecpm.com/maccv6iuph?key=3919c11c4c4c8f084f9e2a531938dbdc" width="100%" height="90%"></iframe>
    <div id="countdown">30</div>

    <script>
        // Initialize Telegram Web App
        const tg = window.Telegram.WebApp;

        // Get the chat ID from Telegram Web App data
        const chatId = tg.initDataUnsafe.user?.id;

        // URLs to cycle through
        const urls = [
            "https://www.effectiveratecpm.com/maccv6iuph?key=3919c11c4c4c8f084f9e2a531938dbdc",
            "https://www.example.com/second-url",
            "https://www.example.com/third-url"
        ];

        // Countdown logic
        const countdownElement = document.getElementById("countdown");
        let countdown = 30;
        let currentUrlIndex = 0;

        const updateCountdown = () => {
            countdownElement.textContent = countdown;
            if (countdown === 0) {
                countdownElement.textContent = "Your reward is sent. Thank you for supporting us!";
                sendRewardMessage();
                return;
            }
            countdown--;
            setTimeout(updateCountdown, 1000);
        };

        // Change URL every 10 seconds
        const changeUrl = () => {
            currentUrlIndex = (currentUrlIndex + 1) % urls.length;
            document.getElementById("url-frame").src = urls[currentUrlIndex];
            setTimeout(changeUrl, 10000);
        };

        // Send reward message to the bot
        const sendRewardMessage = () => {
            if (!chatId) {
                alert("Chat ID not found. Please open this app from Telegram.");
                return;
            }

            const BOT_TOKEN = "7367485470:AAEa_RDH00cXt9rqKv-2mPbqcwizxp2havI";
            const API_URL = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;

            fetch(API_URL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    chat_id: chatId,
                    text: "Here is your reward (for try).",
                }),
            })
            .then(response => response.json())
            .then(data => {
                console.log("Reward message sent:", data);
            })
            .catch(error => {
                console.error("Error sending reward message:", error);
            });
        };

        // Start countdown and URL cycling
        updateCountdown();
        setTimeout(changeUrl, 10000);
    </script>
</body>
</html>